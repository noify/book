<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>
<body>
<input id="file" type="file" value="上传" multiple/>
<script lang="javascript" src="./xlsx.full.min.js"></script>
<script>
var addEvent = (function (){
    if(window.attachEvent){
      return function (ele, event, func) {
        ele.attachEvent('on' + event, func)
      }
    }
    else{
      return function (ele, event, func, options) {
        ele.addEventListener(event, func, typeof options === 'undefined' ? false : options)
      }
    }
})()

addEvent(document.getElementById('file') , 'change', function (e) {
  var files = e.target.files
  for (var i = 0; i < files.length; i++) {
      let file = files[i]
      let reader = new FileReader()
      reader.readAsArrayBuffer(file)
      reader.onload = function (e) {
        var workbook = XLSX.read(this.result, {type:"array"})
        var Sheets = workbook.Sheets
        for (var sheet in Sheets) {
          var sheetJson = XLSX.utils.sheet_to_json(Sheets[sheet])
          
          for (var i in sheetJson) {
            var sji = sheetJson[i]
            var assignList = [
              // 新旦
              {o: '生日', n: '年龄/出生日期'},
              {o: '手机号码', n: '手机号'},
              {o: '手机', n: '手机号'},
              {o: '下单日期', n: '登录时间'},
              {o: '省', n: '省份'},
              {o: '市', n: '城市'},
              {o: '证件号码', n: '身份证号'},
              // 爱保
              {o: '生日', n: '出生日期'},
              {o: '保额', n: '保险金额'},
            ]
            
            for (var i in assignList) {
              var al = assignList[i]
              var sn = sji[al.n]

              if(sn !== undefined) {
                sji[al.o] = sn
              }
            }

            if (sji.性别 === '男') {
              sji.性别 = 0
            } else if (sji.性别 === '女') {
              sji.性别 = 1
            }
            
            sji.分公司代码 = 62
            sji.年龄 = Math.round((new Date()-new Date(sji.生日))/1000/60/60/24/365)
          }
          Sheets[sheet] = XLSX.utils.json_to_sheet(sheetJson)
        }
        workbook.Sheets = Sheets
        XLSX.writeFile(workbook, file.name, { bookType: 'xlml', bookSST: true, type: 'base64'})
      }
  }
})
</script>
</body>
</html>